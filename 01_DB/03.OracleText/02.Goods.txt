-- 商品情報更新トリガを作成
CREATE OR REPLACE TRIGGER TRG_GOODS AFTER
  UPDATE OF GOODS_NAME OR
  DELETE ON GOODS FOR EACH ROW WHEN (
    -- 商品名称が更新された場合、本トリガを実行する
    OLD.GOODS_NAME != NEW.GOODS_NAME ) BEGIN
  -- ユーザ情報のOracleTextインデックスを更新
  UPDATE USR A_USR
  SET A_USR.UPD_USER_ID = A_USR.UPD_USER_ID
  WHERE EXISTS
    (SELECT A_USR.USR_ID
    FROM USR B_USR
    LEFT OUTER JOIN ORDERS
    ON B_USR.USR_ID = ORDERS.ORDER_USR_ID
    LEFT OUTER JOIN ORDERS_DTL
    ON ORDERS.ORDER_ID            = ORDERS_DTL.ORDER_ID
    WHERE A_USR.USR_ID            = B_USR.USR_ID
    AND ORDERS_DTL.ORDER_GOODS_ID = :NEW.GOODS_ID
    );
END;

